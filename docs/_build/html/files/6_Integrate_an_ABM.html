<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Integrate an ABM &mdash; HydroCNHS  documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Data collector" href="7_data_collector.html" />
    <link rel="prev" title="Build a hydrological model" href="5_build_a_hydrological_model.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> HydroCNHS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="2_installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="3_101_classroom.html">101 classroom</a></li>
<li class="toctree-l1"><a class="reference internal" href="4_input_output.html">Input/Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="5_build_a_hydrological_model.html">Build a hydrological model</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Integrate an ABM</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#step-1-create-a-model-configuration-file">Step 1: Create a model configuration file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialize-abm-setting">Initialize ABM setting</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-agents">Add agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#add-institution">Add institution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#generate-abm-module-template-output-model-configuration-file">Generate ABM module template &amp; output model configuration file</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-2-complete-a-model-configuration-file">Step 2: Complete a model configuration file</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-3-program-abm-module-py">Step 3: Program ABM module (<em>.py</em>)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#agent-type-class-agttype">Agent type class (AgtType):</a></li>
<li class="toctree-l3"><a class="reference internal" href="#institutional-decision-making-classes-dmclass">(Institutional) decision-making classes (DMClass):</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#step-4-run-a-calibration">Step 4: Run a calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#step-5-run-a-simulation">Step 5: Run a simulation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="7_data_collector.html">Data collector</a></li>
<li class="toctree-l1"><a class="reference internal" href="8_calibration.html">Calibration</a></li>
<li class="toctree-l1"><a class="reference internal" href="9_advanced%20ABM%20coding%20tips.html">Advanced ABM coding tips</a></li>
<li class="toctree-l1"><a class="reference internal" href="../source/HydroCNHS.html">HydroCNHS package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">HydroCNHS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Integrate an ABM</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/files/6_Integrate_an_ABM.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="integrate-an-abm">
<h1>Integrate an ABM<a class="headerlink" href="#integrate-an-abm" title="Permalink to this headline">¶</a></h1>
<p>After getting familiar with HydroCNHS from the hydrological model example in the previous section, we want to build a water system with human components (i.e., ABM). We will go through a similar process in the last example and focus on adding the human components.
1.      Create a model configuration file (<em>.yaml</em>) using a model builder.
2.      Complete a model configuration file (<em>.yaml</em>)
3.      Program an ABM module (<em>.py</em>)
4.      Run a calibration
5.      Run a simulation
We adopt the Tualatin River Basin (TRB; <a class="reference internal" href="#fig5"><span class="std std-numref">Fig. 5</span></a>; <a class="reference internal" href="#table5"><span class="std std-numref">Table 5</span></a>) as the tutorial example. The corresponding subbasins’ information is shown in <a class="reference internal" href="#table5"><span class="std std-numref">Table 5</span></a>. In this example, we consider three human components (<a class="reference internal" href="#table6"><span class="std std-numref">Table 6</span></a>), including (1) a reservoir (<em>ResAgt</em>), (2) an irrigation diversion (<em>DivAgt</em>), and (3) a trans-basin water transfer (<em>PipeAgt</em>), to demonstrate the HydroCNHS’s functionalities. Also, we model each human agent with different levels of behavioral complexities to provide users with a sense of how an agent can be modeled (<a class="reference internal" href="#table6"><span class="std std-numref">Table 6</span></a>). We will calibrate the model using the streamflow at DLLO and WSLO, reservoir releases from ResAgt, and water diversions from DivAgt on a monthly scale. More details about TRB can be found in Lin et al. (2022). Here, we focus on the coding part.</p>
<div class="figure align-center" id="id1">
<span id="fig5"></span><a class="reference internal image-reference" href="../_images/fig5_TRB_node_link.png"><img alt="The node-link structure of the Tualatin River Basin with human components." src="../_images/fig5_TRB_node_link.png" style="width: 400px;" /></a>
<p class="caption"><span class="caption-number">Fig. 5 </span><span class="caption-text">The node-link structure of the Tualatin River Basin with human components.</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<span id="table5"></span><table class="docutils align-center" id="id2" style="width: 100%">
<caption><span class="caption-number">Table 5 </span><span class="caption-text">Subbasins’ information for the Tualatin River Basin.</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 22%" />
<col style="width: 26%" />
<col style="width: 21%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Subbasin/outlet</p></th>
<th class="head"><p>Drainage area [ha]</p></th>
<th class="head"><p>Latitude [deg]</p></th>
<th class="head"><p>Flow length [m]</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>HaggIn</p></td>
<td><p>10034.2408</p></td>
<td><p>45.469</p></td>
<td><p>0 (to HaggIn)</p></td>
</tr>
<tr class="row-odd"><td><p>TRTR</p></td>
<td><p>329.8013</p></td>
<td><p>45.458</p></td>
<td><p>30899.4048 (to DLLO)</p></td>
</tr>
<tr class="row-even"><td><p>ResAgt<sup>*</sup></p></td>
<td><p>–</p></td>
<td><p>–</p></td>
<td><p>9656.064 (to DLLO)</p></td>
</tr>
<tr class="row-odd"><td><p>DLLO</p></td>
<td><p>22238.4391</p></td>
<td><p>45.475</p></td>
<td><div class="line-block">
<div class="line">0 (to DLLO)</div>
<div class="line">11748.211 (to TRGC)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>TRGC</p></td>
<td><p>24044.6363</p></td>
<td><p>45.502</p></td>
<td><div class="line-block">
<div class="line">0 (to TRGC)</div>
<div class="line">80064.864 (to WSLO)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>DAIRY</p></td>
<td><p>59822.7546</p></td>
<td><p>45.520</p></td>
<td><p>70988.164 (to WSLO)</p></td>
</tr>
<tr class="row-even"><td><p>RCTV</p></td>
<td><p>19682.6046</p></td>
<td><p>45.502</p></td>
<td><p>60398.680 (to WSLO)</p></td>
</tr>
<tr class="row-odd"><td><p>WSLO</p></td>
<td><p>47646.8477</p></td>
<td><p>45.350</p></td>
<td><p>0 (to WSLO)</p></td>
</tr>
<tr class="row-even"><td colspan="4"><p><sup>*</sup>ResAgt is a reservoir agent integrated with Dam API. It is
considered a pseudo routing outlet.</p></td>
</tr>
</tbody>
</table>
<span id="table6"></span><table class="docutils align-center" id="id3" style="width: 100%">
<caption><span class="caption-number">Table 6 </span><span class="caption-text">Summary of human components’ setting.</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 22%" />
<col style="width: 17%" />
<col style="width: 18%" />
<col style="width: 28%" />
<col style="width: 9%" />
<col style="width: 5%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Item</p></th>
<th class="head"><p>Agent name</p></th>
<th class="head"><p>API</p></th>
<th class="head"><p>Behavioral design</p></th>
<th class="head"><p>From</p></th>
<th class="head"><p>To</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Reservoir</p></td>
<td><p>ResAgt</p></td>
<td><p>Dam API</p></td>
<td><p>Fixed operational rules</p></td>
<td><p>HaggIn</p></td>
<td><p>–</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">Irrigation</div>
<div class="line">diversion</div>
</div>
</td>
<td><p>DivAgt</p></td>
<td><p>RiverDiv API</p></td>
<td><p>Calibrated adaptive
behavioral rules</p></td>
<td><p>TRGC</p></td>
<td><p>WSLO</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">Trans-basin</div>
<div class="line">water transfer</div>
</div>
</td>
<td><p>PipeAgt</p></td>
<td><p>Conveying API</p></td>
<td><p>External input data</p></td>
<td><p>–</p></td>
<td><p>TRTR</p></td>
</tr>
</tbody>
</table>
<div class="section" id="step-1-create-a-model-configuration-file">
<h2>Step 1: Create a model configuration file<a class="headerlink" href="#step-1-create-a-model-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>Creating a node-link structure of a modeled water system is a vital step before using HydroCNHS. Subbasin outlets are determined based on the major tributaries in the TRB. However, the subbasin outlet, TRTR, is given because we have an inlet there for trans-basin water transfer. For the routing outlet assignment, DLLO and WSLO are selected because the streamflow at these two is part of the calibration targets, TRGC is also chosen since an agent integrated using RiverDiv API can only divert water from a routing outlet, and HaggIn is picked because it is the inflow of ResAgt (i.e., ResAgt takes water from HaggIn).</p>
<p>With a node-link structure of the TRB water system, we can follow the same process shown in the “Build a hydrological model” to initialize a model builder, set up the water system with the simulation period, add subbasins, and add four routing outlets. Note that ResAgt is considered a pseudo routing outlet that needs to be assigned to one of the upstream outlets of a routing outlet.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">HydroCNHS</span>
<span class="n">prj_path</span><span class="p">,</span> <span class="n">this_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>

<span class="c1">### Initialize a model builder object.</span>
<span class="n">wd</span> <span class="o">=</span> <span class="n">prj_path</span>
<span class="n">mb</span> <span class="o">=</span> <span class="n">HydroCNHS</span><span class="o">.</span><span class="n">ModelBuilder</span><span class="p">(</span><span class="n">wd</span><span class="p">)</span>

<span class="c1">### Setup a water system simulation information</span>
<span class="n">mb</span><span class="o">.</span><span class="n">set_water_system</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;1981/1/1&quot;</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2013/12/31&quot;</span><span class="p">)</span>

<span class="c1">### Setup land surface model (rainfall-runoff model)</span>
<span class="c1"># Here we have seven subbasins and we select GWLF as the rainfall-runoff model.</span>
<span class="n">outlet_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;HaggIn&#39;</span><span class="p">,</span> <span class="s1">&#39;TRTR&#39;</span><span class="p">,</span> <span class="s1">&#39;DLLO&#39;</span><span class="p">,</span> <span class="s1">&#39;TRGC&#39;</span><span class="p">,</span> <span class="s1">&#39;DAIRY&#39;</span><span class="p">,</span> <span class="s1">&#39;RCTV&#39;</span><span class="p">,</span> <span class="s1">&#39;WSLO&#39;</span><span class="p">]</span>
<span class="n">area_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10034.2408</span><span class="p">,</span> <span class="mf">329.8013</span><span class="p">,</span> <span class="mf">22238.4391</span><span class="p">,</span> <span class="mf">24044.6363</span><span class="p">,</span> <span class="mf">59822.7546</span><span class="p">,</span>
            <span class="mf">19682.6046</span><span class="p">,</span> <span class="mf">47646.8477</span><span class="p">]</span>
<span class="n">lat_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">45.469</span><span class="p">,</span> <span class="mf">45.458</span><span class="p">,</span> <span class="mf">45.475</span><span class="p">,</span> <span class="mf">45.502</span><span class="p">,</span> <span class="mf">45.520</span><span class="p">,</span> <span class="mf">45.502</span><span class="p">,</span> <span class="mf">45.350</span><span class="p">]</span>
<span class="n">mb</span><span class="o">.</span><span class="n">set_rainfall_runoff</span><span class="p">(</span><span class="n">outlet_list</span><span class="o">=</span><span class="n">outlet_list</span><span class="p">,</span><span class="n">area_list</span><span class="o">=</span><span class="n">area_list</span><span class="p">,</span>
                    <span class="n">lat_list</span><span class="o">=</span><span class="n">lat_list</span><span class="p">,</span> <span class="n">runoff_model</span><span class="o">=</span><span class="s2">&quot;GWLF&quot;</span><span class="p">)</span>

<span class="c1">### Setup routing outlets</span>
<span class="c1"># Add WSLO</span>
<span class="n">mb</span><span class="o">.</span><span class="n">set_routing_outlet</span><span class="p">(</span><span class="n">routing_outlet</span><span class="o">=</span><span class="s2">&quot;WSLO&quot;</span><span class="p">,</span>
                    <span class="n">upstream_outlet_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TRGC&quot;</span><span class="p">,</span> <span class="s2">&quot;DAIRY&quot;</span><span class="p">,</span> <span class="s2">&quot;RCTV&quot;</span><span class="p">,</span> <span class="s2">&quot;WSLO&quot;</span><span class="p">],</span>
                    <span class="n">flow_length_list</span><span class="o">=</span><span class="p">[</span><span class="mf">80064.864</span><span class="p">,</span> <span class="mf">70988.164</span><span class="p">,</span> <span class="mf">60398.680</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="c1"># Add TRGC</span>
<span class="n">mb</span><span class="o">.</span><span class="n">set_routing_outlet</span><span class="p">(</span><span class="n">routing_outlet</span><span class="o">=</span><span class="s2">&quot;TRGC&quot;</span><span class="p">,</span>
                    <span class="n">upstream_outlet_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;DLLO&quot;</span><span class="p">,</span> <span class="s2">&quot;TRGC&quot;</span><span class="p">],</span>
                    <span class="n">flow_length_list</span><span class="o">=</span><span class="p">[</span><span class="mf">11748.211</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="c1"># Add DLLO</span>
<span class="c1"># Specify that ResAgt is an instream object.</span>
<span class="n">mb</span><span class="o">.</span><span class="n">set_routing_outlet</span><span class="p">(</span><span class="n">routing_outlet</span><span class="o">=</span><span class="s2">&quot;DLLO&quot;</span><span class="p">,</span>
                    <span class="n">upstream_outlet_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ResAgt&quot;</span><span class="p">,</span> <span class="s2">&quot;TRTR&quot;</span><span class="p">,</span> <span class="s2">&quot;DLLO&quot;</span><span class="p">],</span>
                    <span class="n">flow_length_list</span><span class="o">=</span><span class="p">[</span><span class="mf">9656.064</span><span class="p">,</span> <span class="mf">30899.4048</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">instream_objects</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ResAgt&quot;</span><span class="p">])</span>
<span class="c1"># Add HaggIn</span>
<span class="n">mb</span><span class="o">.</span><span class="n">set_routing_outlet</span><span class="p">(</span><span class="n">routing_outlet</span><span class="o">=</span><span class="s2">&quot;HaggIn&quot;</span><span class="p">,</span>
                    <span class="n">upstream_outlet_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;HaggIn&quot;</span><span class="p">],</span>
                    <span class="n">flow_length_list</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<div class="section" id="initialize-abm-setting">
<h3>Initialize ABM setting<a class="headerlink" href="#initialize-abm-setting" title="Permalink to this headline">¶</a></h3>
<p>To add human components, we need to first initialize the ABM setting block by assigning an ABM module folder’s directory and planned ABM module filename. If they are not given, default values will be applied, namely, working directory and “ABM_module.py, “respectively. abm_module_name will be used as the filename for the ABM module template if users choose to generate one using the model builder.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mb</span><span class="o">.</span><span class="n">set_ABM</span><span class="p">(</span><span class="n">abm_module_folder_path</span><span class="o">=</span><span class="n">wd</span><span class="p">,</span> <span class="n">abm_module_name</span><span class="o">=</span><span class="s2">&quot;TRB_ABM.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-agents">
<h3>Add agents<a class="headerlink" href="#add-agents" title="Permalink to this headline">¶</a></h3>
<p>Next, we add human components (i.e., agents) to the model builder.
We first <strong>add a reservoir agent (ResAgt)</strong>, in which its corresponding agent type class, agent name, api, link dictionary, and decision-making class can be assigned at this stage. Although not all information has to be provided now (i.e., it can be manually added to the model configuration file later), we encourage users to provide complete details here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mb</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agt_type_class</span><span class="o">=</span><span class="s2">&quot;Reservoir_AgtType&quot;</span><span class="p">,</span> <span class="n">agt_name</span><span class="o">=</span><span class="s2">&quot;ResAgt&quot;</span><span class="p">,</span>
             <span class="n">api</span><span class="o">=</span><span class="n">mb</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">Dam</span><span class="p">,</span>
             <span class="n">link_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;HaggIn&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;ResAgt&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
             <span class="n">dm_class</span><span class="o">=</span><span class="s2">&quot;ReleaseDM&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The setting shown above means that ResAgt (an agent object) will be created from Reservoir_AgtType (an agent type class) and integrated into HydroCNHS using the Dam API. A decision-making object will be created from ReleaseDM (a decision-making class) and assigned to ResAgt as its attribute. This agent, ResAgt, will take water (factor = -1) from HaggIn routing outlet and release (factor = 1) water to ResAgt. Remember that ResAgt itself is a pseudo routing outlet.</p>
<p>Following a similar procedure, we <strong>add a water diversion agent (DivAgt)</strong>. However, we have parameters, including ReturnFactor, a, and b, involved in this agent. Hence, a dictionary is provided to the par_dict argument. The format of the parameter dictionary is that keys are parameter names, and values are parameter values (-99 means waiting to be calibrated).</p>
<p>However, if the parameter is the factor used in the link_dict, users need to follow the format shown here. For example, we want to calibrate a return factor (ReturnFactor) to determine the portion of diverted water returned to the WSLO subbasin. To do that, a list, [“ReturnFactor”, 0, “Plus”], is given to link_dict at WSLO. HydroCNHS will interpret it as taking the factor value from parameter ReturnFactor with a list index of 0. “Plus” tells HydroCNHS we add water to WSLO. If water is taken from WSLO, then “Minus” should be assigned.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mb</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agt_type_class</span><span class="o">=</span><span class="s2">&quot;Diversion_AgType&quot;</span><span class="p">,</span> <span class="n">agt_name</span><span class="o">=</span><span class="s2">&quot;DivAgt&quot;</span><span class="p">,</span>
             <span class="n">api</span><span class="o">=</span><span class="n">mb</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">RiverDiv</span><span class="p">,</span>
             <span class="n">link_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TRGC&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;WSLO&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ReturnFactor&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Plus&quot;</span><span class="p">]},</span>
             <span class="n">dm_class</span><span class="o">=</span><span class="s2">&quot;DivertDM&quot;</span><span class="p">,</span>
             <span class="n">par_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ReturnFactor&quot;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">99</span><span class="p">],</span> <span class="s2">&quot;a&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="o">-</span><span class="mi">99</span><span class="p">})</span>
</pre></div>
</div>
<p>Finally, we <strong>add a trans-basin water transfer agent (PipeAgt)</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mb</span><span class="o">.</span><span class="n">add_agent</span><span class="p">(</span><span class="n">agt_type_class</span><span class="o">=</span><span class="s2">&quot;Pipe_AgType&quot;</span><span class="p">,</span> <span class="n">agt_name</span><span class="o">=</span><span class="s2">&quot;PipeAgt&quot;</span><span class="p">,</span>
             <span class="n">api</span><span class="o">=</span><span class="n">mb</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">Conveying</span><span class="p">,</span>
             <span class="n">link_dict</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;TRTR&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
             <span class="n">dm_class</span><span class="o">=</span><span class="s2">&quot;TransferDM&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="add-institution">
<h3>Add institution<a class="headerlink" href="#add-institution" title="Permalink to this headline">¶</a></h3>
<p>We did not include an institution in this TRB example; however if users want to assign an institution (e.g., “ResDivInstitution”) to ResAgt and DivAgt, they should do so by assuming that there is a cooperation between water release decisions and water diversion decisions. Namely, release decisions from ResAgt and diversion decisions from DivAgt are made simultaneously using a single decision-making object (<a class="reference internal" href="#fig6"><span class="std std-numref">Fig. 6</span></a>). Users can do the following.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mb</span><span class="o">.</span><span class="n">add_institution</span><span class="p">(</span><span class="n">institution</span><span class="o">=</span><span class="s2">&quot;ResDivInstitution&quot;</span><span class="p">,</span>
                   <span class="n">instit_dm_class</span><span class="o">=</span><span class="s2">&quot; ResDivDMClass&quot;</span><span class="p">,</span>
                   <span class="n">agent_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot; ResAgt &quot;</span><span class="p">,</span> <span class="s2">&quot;DivAgt&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Note that ResDivInstitution will overwrite the originally assigned DM classes (if any) of ResAgt and DivAgt. The above command means a single ResDivInstitution decision-making object initialized from ResDivDMClass will be assigned to ResAgt and DivAgt’s attributes (e.g., <em>self.dm</em>). Users can utilize this property to design their agents.</p>
</div>
<div class="section" id="generate-abm-module-template-output-model-configuration-file">
<h3>Generate ABM module template &amp; output model configuration file<a class="headerlink" href="#generate-abm-module-template-output-model-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>In addition to outputting a model configuration file (<em>.yaml</em>), the model builder can generate an ABM module template (<em>.py</em>) for users, in which the model builder will create the outline of agent type classes and decision-making classes, and users can concentrate on programming the calculation for each class given in the template.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### Output initial model configuration file (.yaml) and ABM module template.</span>
<span class="n">mb</span><span class="o">.</span><span class="n">write_model_to_yaml</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;HydroABMModel.yaml&quot;</span><span class="p">)</span>
<span class="n">mb</span><span class="o">.</span><span class="n">gen_ABM_module_template</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-2-complete-a-model-configuration-file">
<h2>Step 2: Complete a model configuration file<a class="headerlink" href="#step-2-complete-a-model-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>After the model configuration file (<em>.yaml</em>) is created, users should open the file to complete and correct any missing or misinterpreted values. For this example, again, we will keep the default values.</p>
</div>
<div class="section" id="step-3-program-abm-module-py">
<h2>Step 3: Program ABM module (<em>.py</em>)<a class="headerlink" href="#step-3-program-abm-module-py" title="Permalink to this headline">¶</a></h2>
<p>In the generated ABM module (<em>.py</em>), users can find mainly two types of classes, including agent type classes (AgtType) and decision-making classes (DMClass/Institutional DMClass). Agent type classes are used to define agents’ actions and store up-to-date information (e.g., current date and current time step) in agents’ attributes. Decision-making classes are used to program a specific decision-making process. Decision-making classes can be further separated into DMClass and Institutional DMClass.</p>
<p>The ABM design logic is illustrated in <a class="reference internal" href="#fig6"><span class="std std-numref">Fig. 6</span></a>. A “class” is a template for objects that can be initiated with object-specific attributes and settings. For example, Agent1 and Agent2 are initiated from the same AgtType1 class. Agent 2, Agent 4, and Agent 5 are initiated from the AgtType2 class. Each agent will be assigned a DM object or Institution object as one of its attributes. DM objects initiated from DMClass are NOT shared with other agents; Namely, agents with DM objects will only have one unique DM object (e.g., Agent 1 and Agent 2 in <a class="reference internal" href="#fig6"><span class="std std-numref">Fig. 6</span></a>). In contrast, an Institution object can be shared with multiple agents, in which those agents can make decisions together. For example, multiple irrigation districts make diversion decisions together to share the water shortage during a drought period. We will not implement the Institutional DMClass in this TRB example; however, we will show how to add an institution through a model builder.</p>
<div class="figure align-center" id="id4">
<span id="fig6"></span><a class="reference internal image-reference" href="../_images/fig6_ABM_design_logic.png"><img alt="ABM design logic." src="../_images/fig6_ABM_design_logic.png" style="width: 600px;" /></a>
<p class="caption"><span class="caption-number">Fig. 6 </span><span class="caption-text">ABM design logic. An agent is a combination of an AgtType class and an (Institutional) DM class. An Institution object can be shared among a group of agent objects (i.e., make decisions together), while a DM object can only be assigned to one agent object.</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="agent-type-class-agttype">
<h3>Agent type class (AgtType):<a class="headerlink" href="#agent-type-class-agttype" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>self.name</strong>         = agent’s name</p></li>
<li><p><strong>self.config</strong>       = agent’s configuration dictionary, {‘Attributes’: …, ‘Inputs’: …, ‘Pars’: …}.</p></li>
<li><p><strong>self.start_date</strong>   = start date (datetime object).</p></li>
<li><p><strong>self.current_date</strong> = current date (datetime object).</p></li>
<li><p><strong>self.data_length</strong>  = data/simulation length.</p></li>
<li><p><strong>self.t</strong>            = current timestep.</p></li>
<li><p><strong>self.dc</strong>           = data collector object containing data. Routed streamflow (Q_routed) is also collected here.</p></li>
<li><p><strong>self.rn_gen</strong>       = NumPy random number generator.</p></li>
<li><p><strong>self.agents</strong>       = a dictionary of all initialized agents, {agt_name: agt object}.</p></li>
<li><p><strong>self.dm</strong>           = (institutional) decision-making object if DMClass or institution is assigned to the agent, else None.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># AgtType</span>
<span class="k">class</span> <span class="nc">XXX_AgtType</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># The AgtType inherited attributes are applied.</span>
        <span class="c1"># See the note at top.</span>

    <span class="k">def</span> <span class="nf">act</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outlet</span><span class="p">):</span>
        <span class="c1"># Read corresponding factor of the given outlet</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="n">read_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">outlet</span><span class="p">)</span>

        <span class="c1"># Common usage:</span>
        <span class="c1"># Get streamflow of outlet at timestep t</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">Q_routed</span><span class="p">[</span><span class="n">outlet</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">]</span>

        <span class="c1"># Make decision from (Institutional) decision-making</span>
        <span class="c1"># object if self.dm is not None.</span>
        <span class="c1">#decision = self.dm.make_dm(your_arguments)</span>

        <span class="k">if</span> <span class="n">factor</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>     <span class="c1"># Divert from the outlet</span>
            <span class="n">action</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">factor</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>    <span class="c1"># Add to the outlet</span>
            <span class="n">action</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">action</span>
</pre></div>
</div>
</div>
<div class="section" id="institutional-decision-making-classes-dmclass">
<h3>(Institutional) decision-making classes (DMClass):<a class="headerlink" href="#institutional-decision-making-classes-dmclass" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><strong>self.name</strong>   = name of the agent or institute.</p></li>
<li><p><strong>self.dc</strong>     = data collector object containing data. Routed streamflow (Q_routed) is also collected here.</p></li>
<li><p><strong>self.rn_gen</strong> = NumPy random number generator.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># DMClass</span>
<span class="k">class</span> <span class="nc">XXX_DM</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># The (Institutional) DMClass inherited attributes are applied.</span>
        <span class="c1"># See the note at top.</span>

    <span class="k">def</span> <span class="nf">make_dm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">your_arguments</span><span class="p">):</span>
        <span class="c1"># Decision-making calculation.</span>
        <span class="n">decision</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">decision</span>
</pre></div>
</div>
<p>To keep the manual concise, we provide a complete ABM module for the TRB example at <em>./tutorials/HydroABM_example/TRB_ABM_complete.py</em>. Theoretical details can be found in Lin et al. (2022), and more coding tips are available at “Advanced ABM coding tips.”</p>
</div>
</div>
<div class="section" id="step-4-run-a-calibration">
<h2>Step 4: Run a calibration<a class="headerlink" href="#step-4-run-a-calibration" title="Permalink to this headline">¶</a></h2>
<p>First, we load the model configuration file, the climate data, and the observed monthly flow data for DLLO and WSLO, reservoir releases of ResAgt, and water diversions of DivAgt. Here, we have calculated the evapotranspiration using the Hamon method. Therefore, PET data is input along with other data. Note that we manually change the ABM module from “TRB_ABM.py” to “TRB_ABM_complete.py.”</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">HydroCNHS.calibration</span> <span class="k">as</span> <span class="nn">cali</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="c1"># Load climate data</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span><span class="s2">&quot;Temp_degC.csv&quot;</span><span class="p">),</span>
                <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>
<span class="n">prec</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span><span class="s2">&quot;Prec_cm.csv&quot;</span><span class="p">),</span>
                <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>
<span class="n">pet</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span><span class="s2">&quot;Pet_cm.csv&quot;</span><span class="p">),</span>
                <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;list&quot;</span><span class="p">)</span>

<span class="c1"># Load flow gauge monthly data at WSLO</span>
<span class="n">obv_flow_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span><span class="s2">&quot;Cali_M_cms.csv&quot;</span><span class="p">),</span>
                            <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">],</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Date&quot;</span><span class="p">])</span>

<span class="c1"># Load model</span>
<span class="n">model_dict</span> <span class="o">=</span> <span class="n">HydroCNHS</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="s2">&quot;HydroABMModel.yaml&quot;</span><span class="p">))</span>
<span class="c1"># Change the ABM module to the complete one.</span>
<span class="n">model_dict</span><span class="p">[</span><span class="s2">&quot;WaterSystem&quot;</span><span class="p">][</span><span class="s2">&quot;ABM&quot;</span><span class="p">][</span><span class="s2">&quot;Modules&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TRB_ABM_complete.py&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Second, we generate default parameter bounds and create a convertor for calibration. Note that we manually change the default ABM parameter bounds as shown in the code. Details about the Converter are provided in the Calibration section.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate default parameter bounds</span>
<span class="n">df_list</span><span class="p">,</span> <span class="n">df_name</span> <span class="o">=</span> <span class="n">HydroCNHS</span><span class="o">.</span><span class="n">write_model_to_df</span><span class="p">(</span><span class="n">model_dict</span><span class="p">)</span>
<span class="n">par_bound_df_list</span><span class="p">,</span> <span class="n">df_name</span> <span class="o">=</span> <span class="n">HydroCNHS</span><span class="o">.</span><span class="n">gen_default_bounds</span><span class="p">(</span><span class="n">model_dict</span><span class="p">)</span>

<span class="c1"># Modify the default bounds of ABM</span>
<span class="n">df_abm_bound</span> <span class="o">=</span> <span class="n">par_bound_df_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">df_abm_bound</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;ReturnFactor.0&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;DivAgt&#39;</span><span class="p">,</span> <span class="s1">&#39;Diversion_AgType&#39;</span><span class="p">)]]</span> <span class="o">=</span> <span class="s2">&quot;[0, 0.5]&quot;</span>
<span class="n">df_abm_bound</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;DivAgt&#39;</span><span class="p">,</span> <span class="s1">&#39;Diversion_AgType&#39;</span><span class="p">)]]</span> <span class="o">=</span> <span class="s2">&quot;[-1, 1]&quot;</span>
<span class="n">df_abm_bound</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;DivAgt&#39;</span><span class="p">,</span> <span class="s1">&#39;Diversion_AgType&#39;</span><span class="p">)]]</span> <span class="o">=</span> <span class="s2">&quot;[-1, 1]&quot;</span>

<span class="c1"># Create convertor for calibration</span>
<span class="n">converter</span> <span class="o">=</span> <span class="n">cali</span><span class="o">.</span><span class="n">Convertor</span><span class="p">()</span>
<span class="n">cali_inputs</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">gen_cali_inputs</span><span class="p">(</span><span class="n">wd</span><span class="p">,</span> <span class="n">df_list</span><span class="p">,</span> <span class="n">par_bound_df_list</span><span class="p">)</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">converter</span><span class="o">.</span><span class="n">formatter</span>
</pre></div>
</div>
<p>Third, we program the evaluation function for a genetic algorithm (GA). The four calibration targets’ mean Kling-Gupta efficiency (KGE; Gupta et al., 2009) is adopted to represent the model performance.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Code evaluation function for GA algorthm</span>
<span class="k">def</span> <span class="nf">evaluation</span><span class="p">(</span><span class="n">individual</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
    <span class="n">cali_wd</span><span class="p">,</span> <span class="n">current_generation</span><span class="p">,</span> <span class="n">ith_individual</span><span class="p">,</span> <span class="n">formatter</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">info</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">-</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">current_generation</span><span class="p">,</span> <span class="n">ith_individual</span><span class="p">)</span>

    <span class="c1">##### individual -&gt; model</span>
    <span class="c1"># Convert 1D array to a list of dataframes.</span>
    <span class="n">df_list</span> <span class="o">=</span> <span class="n">cali</span><span class="o">.</span><span class="n">Convertor</span><span class="o">.</span><span class="n">to_df_list</span><span class="p">(</span><span class="n">individual</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>
    <span class="c1"># Feed dataframes in df_list to model dictionary.</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model_dict</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_list</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">df_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">HydroCNHS</span><span class="o">.</span><span class="n">load_df_to_model_dict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;Pars&quot;</span><span class="p">)</span>

    <span class="c1">##### Run simuluation</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">HydroCNHS</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">pet</span><span class="p">)</span>

    <span class="c1">##### Get simulation data</span>
    <span class="c1"># Streamflow of routing outlets.</span>
    <span class="n">cali_target</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;WSLO&quot;</span><span class="p">,</span><span class="s2">&quot;DLLO&quot;</span><span class="p">,</span><span class="s2">&quot;ResAgt&quot;</span><span class="p">,</span><span class="s2">&quot;DivAgt&quot;</span><span class="p">]</span>
    <span class="n">cali_period</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;1981-1-1&quot;</span><span class="p">,</span> <span class="s2">&quot;2005-12-31&quot;</span><span class="p">)</span>
    <span class="n">sim_Q_D</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">pd_date_index</span><span class="p">)[[</span><span class="s2">&quot;WSLO&quot;</span><span class="p">,</span><span class="s2">&quot;DLLO&quot;</span><span class="p">]]</span>
    <span class="n">sim_Q_D</span><span class="p">[</span><span class="s2">&quot;ResAgt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">ResAgt</span><span class="p">[</span><span class="s2">&quot;Release&quot;</span><span class="p">]</span>
    <span class="n">sim_Q_D</span><span class="p">[</span><span class="s2">&quot;DivAgt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">DivAgt</span><span class="p">[</span><span class="s2">&quot;Diversion&quot;</span><span class="p">]</span>
    <span class="c1"># Resample the daily simulation output to monthly outputs.</span>
    <span class="n">sim_Q_M</span> <span class="o">=</span> <span class="n">sim_Q_D</span><span class="p">[</span><span class="n">cali_target</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">KGEs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">cali_target</span><span class="p">:</span>
        <span class="n">KGEs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HydroCNHS</span><span class="o">.</span><span class="n">Indicator</span><span class="p">()</span><span class="o">.</span><span class="n">KGE</span><span class="p">(</span>
            <span class="n">x_obv</span><span class="o">=</span><span class="n">obv_flow_data</span><span class="p">[</span><span class="n">cali_period</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">cali_period</span><span class="p">[</span><span class="mi">1</span><span class="p">]][[</span><span class="n">target</span><span class="p">]],</span>
            <span class="n">y_sim</span><span class="o">=</span><span class="n">sim_Q_M</span><span class="p">[</span><span class="n">cali_period</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">cali_period</span><span class="p">[</span><span class="mi">1</span><span class="p">]][[</span><span class="n">target</span><span class="p">]]))</span>

    <span class="n">fitness</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">KGEs</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">fitness</span><span class="p">,)</span>
</pre></div>
</div>
<p>Fourth, we set up a GA for calibration. Again, we will explain calibration in more detail in the Calibration section. Here, only the code is demonstrated. Note that calibration might take some time to run, depending on your system specifications. Users can lower down ‘pop_size’ and ‘max_gen’ if they want to experience the process instead of seeking convergence. In order to debug your code, set ‘paral_cores’ to 1 to show the error message.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;min_or_max&#39;</span><span class="p">:</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pop_size&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;num_ellite&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;prob_cross&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;prob_mut&#39;</span><span class="p">:</span> <span class="mf">0.15</span><span class="p">,</span>
        <span class="s1">&#39;stochastic&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;max_gen&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;sampling_method&#39;</span><span class="p">:</span> <span class="s1">&#39;LHC&#39;</span><span class="p">,</span>
        <span class="s1">&#39;drop_record&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s1">&#39;paral_cores&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;paral_verbose&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;auto_save&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="s1">&#39;print_level&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;plot&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

<span class="n">seed</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">rn_gen</span> <span class="o">=</span> <span class="n">HydroCNHS</span><span class="o">.</span><span class="n">create_rn_gen</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">ga</span> <span class="o">=</span> <span class="n">cali</span><span class="o">.</span><span class="n">GA_DEAP</span><span class="p">(</span><span class="n">evaluation</span><span class="p">,</span> <span class="n">rn_gen</span><span class="p">)</span>
<span class="n">ga</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cali_inputs</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">formatter</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Cali_HydroABMModel_gwlf_KGE&quot;</span><span class="p">)</span>
<span class="n">ga</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">summary</span>
<span class="n">individual</span> <span class="o">=</span> <span class="n">ga</span><span class="o">.</span><span class="n">solution</span>
</pre></div>
</div>
<p>Finally, we export the calibrated model (i.e., <em>Best_HydroABMModel_gwlf_KGE.yaml</em>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">##### Output the calibrated model.</span>
<span class="n">df_list</span> <span class="o">=</span> <span class="n">cali</span><span class="o">.</span><span class="n">Convertor</span><span class="o">.</span><span class="n">to_df_list</span><span class="p">(</span><span class="n">individual</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>
<span class="n">model_best</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">model_dict</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df_list</span><span class="p">):</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">df_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">HydroCNHS</span><span class="o">.</span><span class="n">load_df_to_model_dict</span><span class="p">(</span><span class="n">model_best</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;Pars&quot;</span><span class="p">)</span>
<span class="n">HydroCNHS</span><span class="o">.</span><span class="n">write_model</span><span class="p">(</span><span class="n">model_best</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ga</span><span class="o">.</span><span class="n">cali_wd</span><span class="p">,</span> <span class="s2">&quot;Best_HydroABMModel_gwlf_KGE.yaml&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="step-5-run-a-simulation">
<h2>Step 5: Run a simulation<a class="headerlink" href="#step-5-run-a-simulation" title="Permalink to this headline">¶</a></h2>
<p>After obtaining a calibrated model, users can now use it for any simulation-based experiment (e.g., streamflow uncertainty under climate change). The calibrated model configuration file (i.e., <em>Best_HydroABMModel_gwlf_KGE.yaml</em>) can be directly loaded into HydroCNHS to run a simulation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">### Run a simulation.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">HydroCNHS</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ga</span><span class="o">.</span><span class="n">cali_wd</span><span class="p">,</span> <span class="s2">&quot;Best_HydroABMModel_gwlf_KGE.yaml&quot;</span><span class="p">))</span>
<span class="n">Q</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">prec</span><span class="p">,</span> <span class="n">pet</span><span class="p">)</span>
<span class="n">sim_Q_D</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">pd_date_index</span><span class="p">)[[</span><span class="s2">&quot;WSLO&quot;</span><span class="p">,</span><span class="s2">&quot;DLLO&quot;</span><span class="p">]]</span>
<span class="n">sim_Q_D</span><span class="p">[</span><span class="s2">&quot;ResAgt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">ResAgt</span><span class="p">[</span><span class="s2">&quot;Release&quot;</span><span class="p">]</span>
<span class="n">sim_Q_D</span><span class="p">[</span><span class="s2">&quot;DivAgt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">DivAgt</span><span class="p">[</span><span class="s2">&quot;Diversion&quot;</span><span class="p">]</span>
<span class="n">sim_Q_M</span> <span class="o">=</span> <span class="n">sim_Q_D</span><span class="p">[[</span><span class="s2">&quot;WSLO&quot;</span><span class="p">,</span><span class="s2">&quot;DLLO&quot;</span><span class="p">,</span><span class="s2">&quot;ResAgt&quot;</span><span class="p">,</span><span class="s2">&quot;DivAgt&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c1">### Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">sim_Q_M</span><span class="o">.</span><span class="n">index</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sim_Q_M</span><span class="p">[</span><span class="s2">&quot;DLLO&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$M_</span><span class="si">{gwlf}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sim_Q_M</span><span class="p">[</span><span class="s2">&quot;WSLO&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$M_</span><span class="si">{gwlf}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sim_Q_M</span><span class="p">[</span><span class="s2">&quot;ResAgt&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$M_</span><span class="si">{gwlf}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sim_Q_M</span><span class="p">[</span><span class="s2">&quot;DivAgt&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$M_</span><span class="si">{gwlf}</span><span class="s2">$&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">obv_flow_data</span><span class="p">[</span><span class="s2">&quot;DLLO&quot;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Obv&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">obv_flow_data</span><span class="p">[</span><span class="s2">&quot;WSLO&quot;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Obv&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">obv_flow_data</span><span class="p">[</span><span class="s2">&quot;ResAgt&quot;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Obv&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">obv_flow_data</span><span class="p">[</span><span class="s2">&quot;DivAgt&quot;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Obv&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">75</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">230</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">23</span><span class="p">])</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;DLLO</span><span class="se">\n</span><span class="s2">($m^3/s$)&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;WSLO</span><span class="se">\n</span><span class="s2">($m^3/s$)&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Release</span><span class="se">\n</span><span class="s2">($m^3/s$)&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Diversion</span><span class="se">\n</span><span class="s2">($m^3/s$)&quot;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2006-1-1&quot;</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2006-1-1&quot;</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2006-1-1&quot;</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2006-1-1&quot;</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">align_ylabels</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="5_build_a_hydrological_model.html" class="btn btn-neutral float-left" title="Build a hydrological model" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="7_data_collector.html" class="btn btn-neutral float-right" title="Data collector" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Chung-Yi Lin.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>